---
title: "Gender Wage Inequality in STEM"
author: "Lydia Gibson, Sara Hatter & Ken Vu"
date: 'April 28, 2022'
output:
  beamer_presentation: default
  ioslides_presentation: default
---

# Introduction

```{r echo=FALSE}
dat1 <- read.csv("women-stem.csv")
library(pacman)
suppressWarnings(p_load(dplyr, ggplot2, ggpubr, scales, MASS, car, lmtest))
options(scipen = 100) # remove scientific notation
```

Do we choose our career path based on gender-based social roles or based on top
salary? Although many countries, such as China, have incorporated women into their labor power to become a powerful economy$^1$, women still choose careers that are more in sync to gender stereotype. 

Undoubtedly, personality characteristics associated with women, are sympathy, kindness, and warmth, and reflect a concern about other people. However, the traits associated to men are achievement orientation and ambitiousness, and concern about accomplishing tasks. These characteristics are very noticeable in the stereotypical association of men in the worker role and women in the family role$^2$. 

More schools are encouraging girls to enter STEM programs and provided them with many resources to succeed in these types of careers. Despite these efforts, women tend to choose career where the median pay is lower.

# Introduction cont.

Our research question tries to find associations within STEM college majors that influence median wages. Our goals are to explore the data for STEM college majors and to create a predictive model for median wages.


## Research Question: 

What associations exist within STEM college majors that have an effect on median wages?

## Goals: 

* To explore the data for STEM college majors.
* To create a predictive model for median wage.

# Data Description

The data was obtained from the American Community Survey 2010-2012 Public Use Microdata Series and has been already subsetted to only concern STEM majors (particularly with an interest in women majoring in STEM).  For each row in the data set (which represents one major), there’s a collection of details and statistics about the major, such as the type of major (i.e. Engineering, Health Science, etc), the proportion of women in the sample of individuals working in that particular field, and other relevant pieces of information.


# Data set

* Link to data set: https://github.com/fivethirtyeight/data/blob/master/college-majors/women-stem.csv

The dimensions of the data set are 76 rows (`Major`) by 9 columns.

```{r echo=FALSE, size="tiny", include=FALSE}
head(dat1, n=3)

```

## Variables

- `Median`: Median earnings of full-time, year-round workers

- `Rank`: Rank by median earnings

- `Major_code`: Major code, FO1DP in ACS PUMS

- `Major`: Major description

- `Major_category`: Category of major from Carnevale et al

- `Total`: Total number of people with major

- `Men`: Male graduates

- `Women`:Female graduates

- `ShareWomen`: Women as share of total




# Exploratory Data Analysis


Instead of looking at each individual `Major`, we have set `Major_category` as a factor with the following levels:

```{r echo=FALSE,include=FALSE}
# remove Rank, Major_code, and Major
dat2 <- dat1[,-c(1,2,3)] 

#set major category as a factor
dat2$Major_category <- as.factor(dat2$Major_category)
levels(dat2$Major_category)
```

* [1]"Biology & Life Science"  
* [2]"Computers & Mathematics" 
* [3]"Engineering"            
* [4]"Health"                  
* [5]"Physical Sciences" 



Within the STEM `Majors`, median wage ($Mdn = \$44350, M = \$46118$) ranged from $\$26,000$ for Zoology (Major Category: Biology & Life Sciences) to $\$110,000$ for Petroleum Engineering (Major Category: Engineering). 

```{r echo=FALSE, include=FALSE}
summary(dat2$Median)
```


# Median Wage by Major Category

```{r echo=FALSE, include=FALSE}
boxplot(Median~Major_category,data=dat2)
```

```{r echo=FALSE}
dat2 %>% ggplot(aes(x=Major_category,y=Median)) + geom_boxplot() +
  labs(x="Major Category", y="Median Salary ($)",
title = "Median Salary by Major Category") + theme(axis.text.x=element_text(angle=7.5), # adjust x labels for no overlap
plot.title=element_text(size=17, hjust=0.5)) # adjust title to center
```


# Share Women by Major Category

```{r echo=FALSE, warning=FALSE, message=FALSE}
# Get totals for men and women for each major category
dat_stats <- rbind(
  # Get totals for men
  dat2 %>% group_by(Major_category) %>%summarize(Grand_Total = sum(Men), Proportion=Grand_Total/sum(Total)) %>%
mutate(Sex="Men", labelpos=Proportion/2),
# Get totals for women
dat2 %>% group_by(Major_category) %>%summarize(Grand_Total = sum(Women), Proportion=Grand_Total/sum(Total)) %>%
  mutate(Sex="Women", labelpos=1 - (Proportion/2))) %>% mutate(Sex = Sex %>% factor(levels=c("Women","Men")))
#dat_stats

dat_stats %>% ggplot(aes(x=Major_category,y=Proportion,fill=Sex)) +
  stat_summary(geom = "bar", position="fill") +# stack side by side bars
  theme(axis.text.x=element_text(angle = 7.5),# get x axes labels to fit
        plot.title=element_text(size=17, hjust=0.5)) +# center title
  geom_text(aes(label = paste0(round(100*Proportion,2),"%"),y=labelpos),size = 3,) +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(x="Major Category", y="Proportion of People (%)",
       title="Major Category Proportions by Sex")
```

#

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Got the outliers
outlier_pts <- dat1 %>%filter(Median > 100000 |(Median > 60000 & Major_category == "Physical Sciences"))
dat1 %>%ggplot(aes(x=Major_category,y=Median, color=Major_category, size=ShareWomen)) +
  geom_jitter(alpha = 1/5) +# make circle transparent to show overlap
  theme(axis.text.x = element_text(angle=30, vjust=0.65),
        plot.title = element_text(hjust=0.5),
        plot.subtitle = element_text(hjust=0.5),
        legend.position = c(0.92,0.82)) +
  geom_text(data=outlier_pts, aes(label=Major, size=0.089),nudge_y=2, vjust=-1.6, hjust=0.7) + # label outliers
  labs(title="Median Salary vs Major_category",subtitle="With the data point size affected by ShareWomen") +
  guides(color=FALSE, # remove Major_category legend, remove "a" from legend
         size=guide_legend(override.aes = list(alpha = 1, size = c(3,4.5,5.8))))
```


# Test differences between major categories

Based on our boxplot, we noticed there may be a significant difference between median wage by major category so we ran an ANOVA to test our hypothesis.

```{r echo=FALSE}
# anova of major categories
anova(lm(Median~Major_category,data=dat2))
```



#

* For our analysis, we also removed the columns `Major_code` and `Rank`  as they aren’t relevant predictors for our purposes.

```{r echo=FALSE, size="tiny"}
head(dat2, n=3)

```



# Scaterplot Matrix

```{r echo=FALSE}
pairs(Median~., data=dat2[,-c(1)])
```

# Scatterplot Matrix Insights

* There seems to be a negative association between `ShareWomen` and `Median`. This is one of the main motivators for our research.

* There may be an issues of multicollinearity between `Total`, `Men`, `Women` and `ShareWomen`, so we will run some analyses to assess which of these predictors could be removed from our model.



# Multicollinearity

```{r}
# test for multicollinearity
```



# Methods and Results: Checking Assumptions

Before beginning our analysis, we began by exploring the normality within our response variable, `Median`. 

```{r echo=FALSE, warning=FALSE, message=FALSE}
 dat2 %>% ggplot(mapping=aes(x=(Median))) + geom_histogram(bin.width=5000) +
  geom_density(aes(y=..density.. * (nrow(dat2) * 5000)), color="red")
```


```{r echo=FALSE, include=FALSE}
#test normality of median
MedSal<-dat2$Median #create object median salary 
par(mfrow=c(1,2))
hist(MedSal)
qqnorm(MedSal)
qqline(MedSal)

```

# Box Cox

We notices that there was some skewing, so we decided to do a Box-Cox test to see if a transformation is necessary.

```{r echo=FALSE}
 lm_full <- lm(Median~.,data=dat2)
boxcox(lm_full, lambda=seq(-2.5, 0.5, by =0.5))
```

# Box-Cox Summary output

```{r echo=FALSE}
summary(powerTransform(lm_full))
```

Our rounded power is -1 so we wouldn’t need to transform the data. Also, -1 as a power would make the data difficult to interpret.



# Building Predicitive Model

* We started with an additive model but it removed to many variables so we switched to a model with interactions.

* After running a step-wise selection of our model, we were left with the following model.


```{r echo=FALSE, include=FALSE}
#interaction model
lm1 <- lm(Median ~., data=dat2[-c(2)])
summary(lm1)

```


#

Since the additive model removed all put one predictor, we rerun the the model with interactions

```{r include=FALSE, echo=FALSE}
#interaction model
lm1 <- lm(Median ~(.)^2, data=dat2[-c(2)])
summary(lm1)
```


#

```{r echo=FALSE, include=FALSE}

#step-wise selection
lm2 <- step(lm1)


```


#

```{r echo=FALSE, include=FALSE}
# create reduced model
lm_reduced <- lm(Median ~ Major_category + Men + ShareWomen + Men:ShareWomen,
                 data=dat2[-c(2)])

#anova reduced vs full
anova(lm_reduced, lm2)
summary(lm_reduced)
```


#

```{r include=FALSE}
#interaction model
lm1 <- lm(log(Median) ~(.)^2, data=dat2[-c(2)])
summary(lm1)

#step-wise selection
lm2 <- step(lm1)

# create reduced model
lm_reduced <- lm(log(Median) ~ Major_category + Men + ShareWomen + Men:ShareWomen,
                 data=dat2[-c(2)])

#anova reduced vs full
anova(lm_reduced, lm2)
summary(lm_reduced)
```

# Model Diagnostics

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Standardized Residual vs Fitted plot
stdresid_plt <- ggplot(mapping=aes(x=lm_reduced$fitted.values,
                                   y=rstandard(lm_reduced))) +
  geom_point() + labs(x="Fitted Values", y="Standardized Residuals") +
  geom_hline(yintercept=0) + labs(title="Residuals vs Fitted") +
  theme(plot.title = element_text(, size=17, hjust = 0.5)) + geom_smooth(se=F)
# Normal QQ_plot
norm_qqplt <- ggplot(mapping=aes(sample=rstandard(lm_reduced))) + stat_qq() +
  stat_qq_line() + labs(y="Sample Quantitles", x="Theoretical Quantiles",
                       title="Normal Q-Q Plot") +
  theme(plot.title = element_text(size=17, hjust = 0.5))
# Display the results
ggarrange(stdresid_plt, norm_qqplt, ncol=2)

```


# Cross Validation


# Conclusion

In conclusion

- Point 1

- Point 1

- Point 1

# Further Research

# Bibliography



# Code Appendix

For supplementary R script, visit 

- https://github.com/lgibson7/Gender-Wage-Inequality-in-STEM